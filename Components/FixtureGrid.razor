
@using FixtureManagementBlazor.ViewModels
@using FixtureManagementBlazor.Models
@using MudBlazor

<MudDataGrid    T="FixtureViewModel" 
                ReadOnly="false" 
                Items="@Fixtures" 
                Dense="true" Filterable="true" 
                Striped="true"
                Virtualize="true" FixedHeader="true" Height="700px"
                QuickFilter="@quickFilter"
                RowClass="pt-0 pb-0"> 
        <Columns >
        <PropertyColumn Property="@(f => f.Date)" Sortable="true" Format="dd/MM/yyyy" CellStyle="@rowStyleOverride" Filterable="false" Editable="false" CellClass="pt-0 pb-0 pr-0"/>
        <PropertyColumn Property="@(f => f.Team)" Title="Team" Sortable="true" CellStyle="@rowStyleOverride" Filterable="false" CellClass="pt-0 pb-0">

        </PropertyColumn>
        <PropertyColumn Property="@(f => (f.IsHome ? "H" : "A"))" Title="H/A" Sortable="false" CellStyle="@rowStyleOverride" Filterable="false" CellClass="pt-0 pb-0"/>
        <PropertyColumn Property="@(f => f.Opponent)" Title="Opponent" Sortable="true"  CellStyle="@rowStyleOverride" Filterable="false" CellClass="pt-0 pb-0"/>
        <PropertyColumn Property="@(f => f.Type)" Title="Type" CellStyle="@rowStyleOverride" Filterable="false" CellClass="pt-0 pb-0" Sortable="false"/>
        <PropertyColumn Property="@(f => f.Pitch)" Sortable="false" Title="Pitch" CellStyle="@rowStyleOverride" Filterable="false" Editable="true" CellClass="pt-0 pb-0"/>
        <PropertyColumn Property="@(f => f.Start)" Sortable="false" Title="Start" CellStyle="@rowStyleOverride" Editable="true" Filterable="false" CellClass="pt-0 pb-0"/>
        <PropertyColumn Property="@(f => f.End)" Sortable="false" Title="End" CellStyle="@rowStyleOverride" Editable="true" Filterable="false" CellClass="pt-0 pb-0"/>
        <TemplateColumn Hidden="@(CanEdit)" CellClass="pt-0 pb-0 pa-0"> 
            <CellTemplate>
                <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" Href="@($"/fixture/edit/{context.Item.Id}")" class="pa-0"/>
                <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Delete" Href="@($"/fixture/delete/{context.Item.Id}")" class="pa-0"/>
                <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Schedule" Href="@($"/fixtureallocation/{context.Item.Id}")" class="pa-0"/>
            </CellTemplate>
        </TemplateColumn> 
    </Columns>
</MudDataGrid>

@code {

    [Parameter, EditorRequired]
    public required IQueryable<FixtureViewModel> Fixtures {get; set;}
    [Parameter]
    public bool CanEdit {get; set;}
    [Parameter]
    public String SearchString {get; set;} = "";

    private string rowStyleOverride = "font-size: .8rem; font-weight: 500";

    private Func<FixtureViewModel, bool> quickFilter => x =>
    {
        if (string.IsNullOrWhiteSpace(SearchString))
            return true;

        if (x.Opponent.Contains(SearchString, StringComparison.OrdinalIgnoreCase))
            return true;

        if (x.Team.Contains (SearchString, StringComparison.OrdinalIgnoreCase))
            return true;

        return false;
    };
}   

